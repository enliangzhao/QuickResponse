<style>
    .filter {
        display: inline-block;
        width: 100px;
        height: auto;
    }

    .form-select {
        width: 100px;
    }

    .container {
        position: relative;
        top: 20px;
    }
    
    html{
        width: 100%;
        height: 100%;
    }
    body{
        height: 100%;
       
    }
    nav{
        margin: 0 !important;
        height: 10% !important;
       
    }
    .left{
        float: left;
        width:10%;
        height:100%;

    }
    .lefticon{
        height: 75% !important;
    }
    .right{
        float: right;
    }
    .title_{
        margin-left: 50%;
    }
    
    .breadcrumb{
        margin: 0 !important;
        height: 5% !important;
        padding: 0;
        text-align: left;
    }
    .breadcrumb ol{
        margin: 0;
       
    }
    
    #map{
        margin: 0 !important;
        height: 75%;
        width: 100%;
    }

    .footer{
        height: 10%;
        display:flex;
        justify-content: space-around;
        align-items: center;
    }

    /* Style buttons */
    .btn {
    background-color: DodgerBlue; /* Blue background */
    border: none; /* Remove borders */
    color: white; /* White text */
    font-size: 16px; /* Set a font size */
    cursor: pointer; /* Mouse pointer on hover */
    }
    .btn i {
        font-size: 22px;
    }
    /* Darker background on mouse-over */
    .btn:hover {
        background-color: RoyalBlue;
    }

    
    
</style>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <title>QuickResponser</title>
</head>
<body>
  <nav>
     <a href="#" data-target="slide-out" class="sidenav-trigger"><i class="material-icons">menu</i></a>
     <p > QucikResponser </p>> 
  </nav>

  <ul id="slide-out" class="sidenav">
    <li><div class="user-view">
      <div class="background">
        <img src="../images/touxiang.jpg">
      </div>
      <a href="#user"><img class="circle" src="../images/touxiang.jpg"></a>
      <a href="#name"><span class="white-text name">John Doe</span></a>
    </div></li>
    <li><a href="/user_profile">Profile</a></li>
    <li><a href="#!">Notifications</a></li>
  </ul>

<div>
    
    <div id="head">

    </div>
    <div class="d-flex justify-content-center mt-4">
        <h4>Crime Statistics</h4>
    </div>
    <form class="pt-4 pl-5 pr-5" id="form">
        <div class="form-group">
            <label for="type">Crime Type</label>
            <select id="type" class="form-control">
                <option selected value="">-</option>
                <option value="Robbery">Robbery</option>
                <option value="Violence">Violence</option>
                <option value="Sexual">Sexual Harassment</option>
            </select>
        </div>


        <div class="form-group">
            <label for="date">Month</label>
            <input id="month" type="month" class="form-control" min="2021-01" max="2021-11" value="2021-11">
        </div>

        <div class="form-group">
            <label for="location">Location</label>
            <select id="location" class="form-control">
                <option selected value="">-</option>
                <option value="Los Angeles">Los Angeles</option>
                <option value="Miami">Miami</option>
                <option value="New York">New York</option>
            </select>

        </div>

        <div class="form-group">
            <button type="button" class="btn btn-default" aria-label="Left Align" id="locationbutton">
                <i class="fas fa-map-marker-alt"></i>
            </button>
            <label for="location" style="visibility:hidden" id="locationlabel">Mountain View, CA</label>
        </div>


    </form>

    
    <div style="text-align:center">
        <button class="btn btn-primary" id="apply-button">Submit</button>
    </div>


    <div class="col text-center" style="margin-top: 30px;" >
        <div class="btn-group btn-group-sm" role="group" aria-label="Basic example" id="buttongroup" style="visibility:hidden">
            <button type="button" class="btn btn-default" id="tablebutton">Table</button>
            <button type="button" class="btn btn-default" id="chartbutton">Chart</button>
          </div>
    </div>




    <div class="container" >
        <table class="table table-striped" style="font-size:12px" id="table" style="visibility:hidden">
        </table>
    </div>
    <div style="visibility:hidden" align="center" id="chart">
        <p >Monthly Crime Chart</p>
        <canvas id="myChart" style="max-width: 500px;" ></canvas>
    </div>

    <div class="footer">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
        <button class='btn btn-primary' onclick="window.location.href='/';"><i class="large material-icons">home</i></button>
        <button class='btn btn-primary' onclick="window.location.href='post_report';"><i class="large material-icons">report</i></button>
        <button class='btn btn-primary' onclick="window.location.href='access_crime_history';"><i class="large material-icons">history</i></button>
        <button class='btn btn-primary' onclick="window.location.href='statistics';"><i class="large material-icons">insert_chart</i></button>
      </div>
</div>
</body>


<script>
//line
var ctxL = document.getElementById("myChart").getContext('2d');
var lines = [];
var cases = [];

    // setNavbarBack("station");
    var chooseLocation = -1;
    var tableData=[];

    $(function () {
        // checkPrivilege()
        // setMinDate();
        $('#apply-button').on('click', function () {
            document.getElementById("table").style.visibility = "";
            document.getElementById("chart").style.visibility = "hidden";
            
            $('#table-body').empty();
            $('#table').empty();
            if(checkInput() == 1) {
                document.getElementById("buttongroup").style.visibility = "";
                viewTable();
            }
        });

        $('#location').on('click', function () {
            document.getElementById("locationlabel").style.visibility = "hidden";
        });
        $('#chartbutton').on('click', function () {
            document.getElementById("table").style.visibility = "hidden";
            document.getElementById("chart").style.visibility = "";
            $('#table-body').empty();
            $('#table').empty();


        });
        $('#tablebutton').on('click', function () {
            document.getElementById("table").style.visibility = "";
            document.getElementById("chart").style.visibility = "hidden";
            $('#table-body').empty();
            $('#table').empty();
            createTable(tableData);
        });

        $('#locationbutton').on('click', function () {
            chooseLocation = 0;
            document.getElementById("locationlabel").style.visibility = "";
            $('#location').val('');
        });
        function checkInput() {
            const data = {
                location: $('#location').val(),
                type: $('#type').val(),
                month: $('#month').val(),
                label: document.getElementById("locationlabel").style.visibility
            }
            if (data.type == "") {
                alert('Please choose the crime type');
                return -1;
            }
            if (data.month == "") {
                alert('Please choose the month');
                return -1;
            }
            if (data.location == "" && data.label == "hidden") {
                alert('Please choose the location');
                return -1;
            }
            if (data.month.localeCompare("2021-01") < 0 || data.month.localeCompare("2021-11") > 0) {
                alert('Please choose the month between 2021/01 to 2021/11');
                return -1;
            }
            return 1;
        }
        function createTable(res) {
            $('#table').append('<tbody id="table-body"></tbody>');
            $('#table').append('<thead><tr><th>City</th><th>Type</th><th>Case</th><th>Month</th></tr></thead>')
            for (var i = 0; i < res.length; i++) {
                    $('#table-body').append(`<tr><td>${res[i].location}</td><td>${res[i].type}</td><td>${res[i].case}</td><td>${res[i].month}</td></tr>`);
            }
        }
        function viewTable() {
            // $(".alert").alert('close');
            const data = {
                location: $('#location').val(),
                type: $('#type').val(),
                month: $('#month').val()
            }
            document.getElementById("table").style.visibility = "";

            if (data.location == "") data.location = "mtv";
            $.ajax({
                method: 'POST',
                url: `/statistics`,
                contentType: 'application/json',
                data: JSON.stringify(data),
                statusCode: {
                    403: (res) => {
                        console.log(res);
                    },
                    /* Handle the successful registration response */
                    200: (res) => {
                        //console.log(res);
                        $('#table-body').empty();
                        $('#table').empty();

                        if (res.length == 0) {
                            const alert = 'There is no data on that day'
                            $('#head').append(`<div class='alert alert-warning alert-dismissable' id='fail-alert'><button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;</button>${alert}</div> `);
                            return;
                        }
                        tableData=res;
                        createTable(tableData);                        
                        $.ajax({
                            method: 'POST',
                            url: `/statistics/months`,
                            contentType: 'application/json',
                            data: JSON.stringify(data),
                            statusCode: {
                                403: (res) => {
                                    console.log(res);
                                },
                                /* Handle the successful registration response */
                                200: (res) => {
                                    //console.log(res);

                                    parseData(res);
                                },
                            },
                        });
                    },
                },
            });

        }
        function parseData(table) {
            var pre = "";
            var line = [];
            lines = [];
            cases = [];
            for (var i = 0; i < table.length; i++) {
                if (i == 0) {
                    pre = table[i].location;
                    lines.push(pre);
                }
                else if (table[i].location != pre) {
                    pre = table[i].location;
                    lines.push(pre);
                    cases.push(line);
                    line = [];
                }
                line.push(table[i].case);
            }
            cases.push(line);

            var myLineChart = new Chart(ctxL, {
                type: 'line',
                data: {
                labels: ["2021-01", "2021-02", "2021-03", "2021-04", "2021-05", "2021-06", "2021-07", "2021-08", "2021-09", "2021-10", "2021-11"],
                datasets: [{
                label: lines[0],
                data: cases[0],
                backgroundColor: [
                'rgba(105, 0, 132, .2)',
                ],
                borderColor: [
                'rgba(200, 99, 132, .7)',
                ],
                borderWidth: 2,
                lineTension: 0
                },
                {
                label: lines[1],
                data: cases[1],
                backgroundColor: [
                'rgba(0, 137, 132, .2)',
                ],
                borderColor: [
                'rgba(0, 10, 130, .7)',
                ],
                borderWidth: 2,
                lineTension: 0
                },
                {
                label: lines[2],
                data: cases[2],
                backgroundColor: [
                'rgba(0,255,0,0.3)',
                ],
                borderColor: [
                'rgba(0,255,0,0.3)',
                ],
                borderWidth: 2,
                lineTension: 0
                }
                ]
                },
                options: {
                responsive: true
                }
            });

        }
    })

</script>

<script src="../js/common.js"></script>
<style>
    p,body,h1,h2,h3,span,textarea,div{
        margin: 0;
        padding: 0;
    }
    html{
        width: 100%;
        height: 100%;
    }
    body{
        height: 100%;
       
    }
    nav{
        margin: 0 !important;
        width: 100% !important;
        height: 7% !important;
       
    }

    nav p{
      text-align: center;
    }
    .sidenav-trigger{
      margin: 0 !important;
    }
    
   

    
    .report_crime{
        margin-left: 5%;
        margin-top: 5%;
        height: 40%;
        width: 90%;
       
    }

    .report_crime h3{
        font-size: 18px;
        line-height: 18px;
        padding-left:2px;
        font-weight: 700;
        height: 10%;
    }

    
    #textform{
        height:90%;
        background-color: rgba(233, 232, 232);
        padding: 5px 5px 0px 5px;
    }

    textarea{
        height:100%;
        width: 100%;
    }
    #areabox{
        height: 75%;
        width: 100%;
    }

    #camera{
        height: 15%;
        text-align:start;
        font-size: 3rem;
        display: flex;
        justify-content: center;
        align-content: center;
        
        
    }
    .pic_upload{
      margin-top: 0.8rem;
      height: 100%;
      width: 90%;
      font-size: x-small;
      
    }

    #place{
        font-size: 2.5rem;
       
    }
    #address{
      float: left;
      visibility: hidden;
    }

    .report_survey{
      margin-left: 5%;
        margin-top: 5%;
        height: 30%;
        width: 90%;
    }

    .report_survey h3{
        font-size: 18px;
        line-height: 18px;
        padding-left:2px;
        font-weight: 700;
        height: 10%;
    }

    #surveyform{
        height:90%;
        background-color: rgba(233, 232, 232);
        padding: 5px 5px 0px 5px;
    }



    .confirm-lane{
      margin-left: 5%;
        margin-top: 5%;
        height: 10%;
        width: 90%;
    }

    .two-button{
      display: flex;
      justify-content: space-between;
    }
    .two-button .btn{
      font-size: 10px !important;
    }


    .footer{
        height: 10%;
        display:flex;
        justify-content: space-around;
        align-items: center;
        background-color: rgb(244, 156, 171);
    }

    /* Style buttons */
    .btn {
    background-color: rgb(29, 128, 228); /* Blue background */
    border: none; /* Remove borders */
    color: white; /* White text */
    font-size: 16px; /* Set a font size */
    cursor: pointer; /* Mouse pointer on hover */
    }
    .btn i {
        font-size: 22px;
    }
    /* Darker background on mouse-over */
    .btn:hover {
        background-color: RoyalBlue;
    }

    


    @font-face {
  font-family: "iconfont"; /* Project id 2960847 */
  src: url('//at.alicdn.com/t/font_2960847_qrenzvwwnt.woff2?t=1637700509438') format('woff2'),
       url('//at.alicdn.com/t/font_2960847_qrenzvwwnt.woff?t=1637700509438') format('woff'),
       url('//at.alicdn.com/t/font_2960847_qrenzvwwnt.ttf?t=1637700509438') format('truetype');
}

.iconfont {
  font-family: "iconfont" !important;
  font-size: 16px;
  font-style: normal;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.quick-xiaotou:before {
  content: "\e60b";
}

.quick-a-Pillsdrugs:before {
  content: "\e608";
}

.quick-bomb:before {
  content: "\e609";
}

.quick-a-qiangzhiqiangfanzuiweixian:before {
  content: "\e60a";
}

.quick-robbery:before {
  content: "\e607";
}

    
</style>